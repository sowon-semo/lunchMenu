
<!DOCTYPE html>	
<html lang="ko">
  <head>
    <title>주소 찾기</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
  </head>
  <body onload="execDaumPostcode()">
  <div id = "layer" style = "display:block; position:absolute; overflow:hidden; z-index:1; -webkit-overflow-scrolling:touch; ">
  </div>
  <script src="https://spi.maps.daum.net/imap/map_js_init/postcode.v2.js"></script>
  <script src="dapi.kakao.com/v2/maps/sdk.js?appkey={dbc379724e0f6871390b64497ffaadc2}&libraries=services"></script>
  <script>
    window.addEventListener("message", onReceivedPostMessage, false);

    function onReceivedPostMessage(event){
      //..ex deconstruct event into action & params
      var action = event.data.action;
      var params = event.data.params;
      console.log("onReceivedPostMessage "+event);
    }

    function onReceivedActivityMessageViaJavascriptInterface(json){
      //..ex deconstruct data into action & params
      var data = JSON.parse(json);
      var action = data.action;
      var params = data.params;
      console.log("onReceivedActivityMessageViaJavascriptInterface "+event);
    }

    function postMessageToiOS(postData) {
        window.webkit.messageHandlers.callBackHandler.postMessage(postData);
    }

    var element_layer = document.getElementById('layer');
    function execDaumPostcode() {
      new daum.Postcode({
        oncomplete: function(data) {
          
          Promise.resolve(data).then(o => {
            const { address } = data;
            
            return new Promise((resolve, reject) => {
              const geocoder = new daum.maps.services.Geocoder();
              
              geocoder.addressSearch(address, (result, status) => {
                if(status === daum.maps.services.Status.OK) {
                  const { x, y } = result[0];
                  
                  resolve({ lat: y, lon: x })
                } else {
                  reject();
                }
              });
            })
          }).then(result => {
            
            // 결과
            var jibunAddress = ""

          var addressData = ""
          if (data.userSelectedType == "R")
          {
              addressData = data.roadAddress 
          }
          else
          {
            if (data.jibunAddress == "") {
              addressData = data.autoJibunAddress
            } else if (data.autoJibunAddress == "") {
              addressData = data.jibunAddress
            }
          }
          
          var postData = {
              adressdata : addressData,
              zonecode : data.zonecode,
              buildingname : data.buildingName,
              x : resolve.lon,
              y : resolve.lat
          };
          
          console.log("PSJ_CHECK "+data);
           console.log("PSJ_CHECK "+data.buildingName);
          
          window.postMessageToiOS(postData);
          });
          
          
        },
        width : '100%',
        height : '100%'
      }).embed(element_layer);
      element_layer.style.display = 'block';
      initLayerPosition();
    }

    function initLayerPosition(){
      var width = (window.innerWidth || document.documentElement.clientWidth);
      var height = (window.innerHeight || document.documentElement.clientHeight);
      element_layer.style.width = width + 'px';
      element_layer.style.height = height + 'px';
      element_layer.style.left = (((window.innerWidth || document.documentElement.clientWidth) - width)/2) + 'px';
      element_layer.style.top = (((window.innerHeight || document.documentElement.clientHeight) - height)/2) + 'px';
    }
  </script>
  </body>
</html>
